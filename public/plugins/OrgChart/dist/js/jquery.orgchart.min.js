
"use strict";(function(a){if(typeof module==="object"&&typeof module.exports==="object"){a(require("jquery"),window,document)}else{a(jQuery,window,document)}}(function(i,o,y,l){i.fn.orgchart=function(L){var I={nodeTitle:"name",nodeId:"id",toggleSiblingsResp:false,depth:999,chartClass:"",exportButton:false,exportFilename:"OrgChart",exportFileextension:"png",parentNodeSymbol:"fa-users",draggable:false,direction:"t2b",pan:false,zoom:false};switch(L){case"buildHierarchy":return w.apply(this,Array.prototype.splice.call(arguments,1));case"addChildren":return s.apply(this,Array.prototype.splice.call(arguments,1));case"addParent":return a.apply(this,Array.prototype.splice.call(arguments,1));case"addSiblings":return d.apply(this,Array.prototype.splice.call(arguments,1));case"removeNodes":return z.apply(this,Array.prototype.splice.call(arguments,1));case"getHierarchy":return x.apply(this,Array.prototype.splice.call(arguments,1));case"hideParent":return D.apply(this,Array.prototype.splice.call(arguments,1));case"showParent":return g.apply(this,Array.prototype.splice.call(arguments,1));case"hideChildren":return B.apply(this,Array.prototype.splice.call(arguments,1));case"showChildren":return v.apply(this,Array.prototype.splice.call(arguments,1));case"hideSiblings":return q.apply(this,Array.prototype.splice.call(arguments,1));case"showSiblings":return j.apply(this,Array.prototype.splice.call(arguments,1));case"getNodeState":return F.apply(this,Array.prototype.splice.call(arguments,1));case"getRelatedNodes":return E.apply(this,Array.prototype.splice.call(arguments,1));default:var M=i.extend(I,L)}var K=this;var O=M.data;var J=i("<div>",{data:{options:M},"class":"orgchart"+(M.chartClass!==""?" "+M.chartClass:"")+(M.direction!=="t2b"?" "+M.direction:""),click:function(Q){if(!i(Q.target).closest(".node").length){J.find(".node.focused").removeClass("focused")}}});if(i.type(O)==="object"){if(O instanceof i){w(J,p(O.children()),0,M)}else{w(J,M.ajaxURL?O:t(O,"00"),0,M)}}else{i.ajax({url:O,dataType:"json",beforeSend:function(){J.append('<i class="fa fa-circle-o-notch fa-spin spinner"></i>')}}).done(function(R,S,Q){w(J,M.ajaxURL?R:t(R,"00"),0,M)}).fail(function(Q,S,R){console.log(R)}).always(function(){J.children(".spinner").remove()})}K.append(J);if(M.exportButton&&!K.find(".oc-export-btn").length){var N=i("<button>",{"class":"oc-export-btn"+(M.chartClass!==""?" "+M.chartClass:""),text:"Export",click:function(T){T.preventDefault();if(i(this).children(".spinner").length){return false}var S=K.find(".mask");if(!S.length){K.append('<div class="mask"><i class="fa fa-circle-o-notch fa-spin spinner"></i></div>')}else{S.removeClass("hidden")}var R=K.addClass("canvasContainer").find(".orgchart:visible").get(0);var Q=M.direction==="l2r"||M.direction==="r2l";html2canvas(R,{width:Q?R.clientHeight:R.clientWidth,height:Q?R.clientWidth:R.clientHeight,onclone:function(U){i(U).find(".canvasContainer").css("overflow","visible").find(".orgchart:visible:first").css("transform","")},onrendered:function(X){K.find(".mask").addClass("hidden");if(M.exportFileextension.toLowerCase()==="pdf"){var Z={};var W=Math.floor(X.width*0.2646);var V=Math.floor(X.height*0.2646);if(W>V){Z=new jsPDF("l","mm",[W,V])}else{Z=new jsPDF("p","mm",[V,W])}Z.addImage(X.toDataURL(),"png",0,0);Z.save(M.exportFilename+".pdf")}else{var U="WebkitAppearance" in y.documentElement.style;var aa=!!o.sidebar;var Y=navigator.appName==="Microsoft Internet Explorer"||(navigator.appName==="Netscape"&&navigator.appVersion.indexOf("Edge")>-1);if((!U&&!aa)||Y){o.navigator.msSaveBlob(X.msToBlob(),M.exportFilename+".png")}else{K.find(".oc-download-btn").attr("href",X.toDataURL())[0].click()}}}}).then(function(){K.removeClass("canvasContainer")},function(){K.removeClass("canvasContainer")})}});K.append(N);if(M.exportFileextension.toLowerCase()!=="pdf"){var P='<a class="oc-download-btn'+(M.chartClass!==""?" "+M.chartClass:"")+'" download="'+M.exportFilename+'.png"></a>';N.after(P)}}if(M.pan){K.css("overflow","hidden");J.on("mousedown touchstart",function(X){var W=i(this);if(i(X.target).closest(".node").length||(X.touches&&X.touches.length>1)){W.data("panning",false);return}else{W.css("cursor","move").data("panning",true)}var V=0;var T=0;var U=W.css("transform");if(U!=="none"){var S=U.split(",");if(U.indexOf("3d")===-1){V=parseInt(S[4]);T=parseInt(S[5])}else{V=parseInt(S[12]);T=parseInt(S[13])}}var R=0;var Q=0;if(!X.targetTouches){R=X.pageX-V;Q=X.pageY-T}else{if(X.targetTouches.length===1){R=X.targetTouches[0].pageX-V;Q=X.targetTouches[0].pageY-T}else{if(X.targetTouches.length>1){return}}}J.on("mousemove touchmove",function(ab){if(!W.data("panning")){return}var ac=0;var aa=0;if(!ab.targetTouches){ac=ab.pageX-R;aa=ab.pageY-Q}else{if(ab.targetTouches.length===1){ac=ab.targetTouches[0].pageX-R;aa=ab.targetTouches[0].pageY-Q}else{if(ab.targetTouches.length>1){return}}}var Z=W.css("transform");if(Z==="none"){if(Z.indexOf("3d")===-1){W.css("transform","matrix(1, 0, 0, 1, "+ac+", "+aa+")")}else{W.css("transform","matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+ac+", "+aa+", 0, 1)")}}else{var Y=Z.split(",");if(Z.indexOf("3d")===-1){Y[4]=" "+ac;Y[5]=" "+aa+")"}else{Y[12]=" "+ac;Y[13]=" "+aa}W.css("transform",Y.join(","))}})});i(y).on("mouseup touchend",function(Q){if(J.data("panning")){J.data("panning",false).css("cursor","default").off("mousemove")}})}if(M.zoom){K.on("wheel",function(Q){Q.preventDefault();var R=1+(Q.originalEvent.deltaY>0?-0.2:0.2);G(J,R)});K.on("touchstart",function(Q){if(Q.touches&&Q.touches.length===2){J.data("pinching",true);var R=c(Q);J.data("pinchDistStart",R)}});i(y).on("touchmove",function(Q){if(J.data("pinching")){var R=c(Q);J.data("pinchDistEnd",R)}}).on("touchend",function(R){if(J.data("pinching")){J.data("pinching",false);var Q=J.data("pinchDistEnd")-J.data("pinchDistStart");if(Q>0){G(J,1.2)}else{if(Q<0){G(J,0.8)}}}})}return K};function c(I){return Math.sqrt((I.touches[0].clientX-I.touches[1].clientX)*(I.touches[0].clientX-I.touches[1].clientX)+(I.touches[0].clientY-I.touches[1].clientY)*(I.touches[0].clientY-I.touches[1].clientY))}function G(I,K){var J=I.css("transform");if(J==="none"){I.css("transform","scale("+K+","+K+")")}else{if(J.indexOf("3d")===-1){I.css("transform",J+" scale("+K+","+K+")")}else{I.css("transform",J+" scale3d("+K+","+K+", 1)")}}}function p(J){var I={name:J.contents().eq(0).text().trim(),relationship:(J.parent().parent().is("li")?"1":"0")+(J.siblings("li").length?1:0)+(J.children("ul").length?1:0)};if(J[0].id){I.id=J[0].id}J.children("ul").children().each(function(){if(!I.children){I.children=[]}I.children.push(p(i(this)))});return I}function t(J,I){J.relationship=I+(J.children&&J.children.length>0?1:0);if(J.children){J.children.forEach(function(K){t(K,"1"+(J.children.length>1?1:0))})}return J}function C(J){var K=J.find("tr:first");var I={id:K.find(".node")[0].id};K.siblings(":last").children().each(function(){if(!I.children){I.children=[]}I.children.push(C(i(this)))});return I}function x(I){var I=I||i(this).find(".orgchart");if(!I.find(".node:first")[0].id){return"Error: Nodes of orghcart to be exported must have id attribute!"}return C(I)}function F(J,K){var I={};if(K==="parent"){I=J.closest(".nodes").siblings(":first")}else{if(K==="children"){I=J.closest("tr").siblings()}else{if(K==="siblings"){I=J.closest("table").parent().siblings()}}}if(I.length){if(I.is(":visible")){return{exist:true,visible:true}}return{exist:true,visible:false}}return{exist:false,visible:false}}function E(I,J){if(J==="parent"){return I.closest(".nodes").parent().children(":first").find(".node")}else{if(J==="children"){return I.closest("table").children(":last").children().find(".node:first")}else{if(J==="siblings"){return I.closest("table").parent().siblings().find(".node:first")}}}}function D(I){var M=I.closest("table").closest("tr").siblings();if(M.eq(0).find(".spinner").length){I.closest(".orgchart").data("inAjax",false)}if(F(I,"siblings").visible){q(I)}var L=M.slice(1);L.css("visibility","hidden");var K=M.eq(0).find(".node");var J=F(K,"parent").visible;if(K.length&&K.is(":visible")){K.addClass("slide slide-down").one("transitionend",function(){K.removeClass("slide");L.removeAttr("style");M.addClass("hidden")})}if(K.length&&J){D(K)}}function g(I){var K=I.closest("table").closest("tr").siblings().removeClass("hidden");K.eq(2).children().slice(1,-1).addClass("hidden");var J=K.eq(0).find(".node")[0];b(J);i(J).addClass("slide").removeClass("slide-down").one("transitionend",function(){i(J).removeClass("slide");if(k(I)){n(I.children(".topEdge"))}})}function B(J){var M=J.closest("tr").siblings();if(M.last().find(".spinner").length){J.closest(".orgchart").data("inAjax",false)}var I=M.last().find(".node:visible");var K=M.last().is(".verticalNodes")?true:false;if(!K){var L=I.closest("table").closest("tr").prevAll(".lines").css("visibility","hidden")}I.addClass("slide slide-up").eq(0).one("transitionend",function(){I.removeClass("slide");if(K){M.addClass("hidden")}else{L.removeAttr("style").addClass("hidden").siblings(".nodes").addClass("hidden");M.last().find(".verticalNodes").addClass("hidden")}if(k(J)){n(J.children(".bottomEdge"))}})}function v(I){var L=I.closest("tr").siblings();var J=L.is(".verticalNodes")?true:false;var K=J?L.removeClass("hidden").find(".node:visible"):L.removeClass("hidden").eq(2).children().find("tr:first").find(".node:visible");b(K.get(0));K.addClass("slide").removeClass("slide-up").eq(0).one("transitionend",function(){K.removeClass("slide");if(k(I)){n(I.children(".bottomEdge"))}})}function q(J,L){var I=J.closest("table").parent();if(I.siblings().find(".spinner").length){J.closest(".orgchart").data("inAjax",false)}if(L){if(L==="left"){I.prevAll().find(".node:visible").addClass("slide slide-right")}else{I.nextAll().find(".node:visible").addClass("slide slide-left")}}else{I.prevAll().find(".node:visible").addClass("slide slide-right");I.nextAll().find(".node:visible").addClass("slide slide-left")}var K=I.siblings().find(".slide");var M=K.closest(".nodes").prevAll(".lines").css("visibility","hidden");K.eq(0).one("transitionend",function(){M.removeAttr("style");var N=L?(L==="left"?I.prevAll(":not(.hidden)"):I.nextAll(":not(.hidden)")):I.siblings();I.closest(".nodes").prev().children(":not(.hidden)").slice(1,L?N.length*2+1:-1).addClass("hidden");K.removeClass("slide");N.find(".node:visible:gt(0)").removeClass("slide-left slide-right").addClass("slide-up").end().find(".lines, .nodes, .verticalNodes").addClass("hidden").end().addClass("hidden");if(k(J)){h(J)}})}function j(J,M){var L=i();if(M){if(M==="left"){L=J.closest("table").parent().prevAll().removeClass("hidden")}else{L=J.closest("table").parent().nextAll().removeClass("hidden")}}else{L=J.closest("table").parent().siblings().removeClass("hidden")}var I=J.closest("table").closest("tr").siblings();if(M){I.eq(2).children(".hidden").slice(0,L.length*2).removeClass("hidden")}else{I.eq(2).children(".hidden").removeClass("hidden")}if(!F(J,"parent").visible){I.removeClass("hidden");var K=I.find(".node")[0];b(K);i(K).addClass("slide").removeClass("slide-down").one("transitionend",function(){i(this).removeClass("slide")})}L.find(".node:visible").addClass("slide").removeClass("slide-left slide-right").eq(-1).one("transitionend",function(){L.find(".node:visible").removeClass("slide");if(k(J)){h(J);J.children(".topEdge").removeClass("fa-chevron-up").addClass("fa-chevron-down")}})}function e(L,J,K){var I=J.closest(".orgchart");if(typeof I.data("inAjax")!=="undefined"&&I.data("inAjax")===true){return false}L.addClass("hidden");J.append('<i class="fa fa-circle-o-notch fa-spin spinner"></i>');J.children().not(".spinner").css("opacity",0.2);I.data("inAjax",true);i(".oc-export-btn"+(K.chartClass!==""?"."+K.chartClass:"")).prop("disabled",true);return true}function r(L,J,K){var I=J.closest("div.orgchart");L.removeClass("hidden");J.find(".spinner").remove();J.children().removeAttr("style");I.data("inAjax",false);i(".oc-export-btn"+(K.chartClass!==""?"."+K.chartClass:"")).prop("disabled",false)}function k(I){return I.children(".edge").attr("class").indexOf("fa-")>-1?true:false}function n(I){I.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down")}function h(J){var M=J.closest(".orgchart").data("options");if(M.toggleSiblingsResp&&(typeof M.ajaxURL==="undefined"||J.closest(".nodes").data("siblingsLoaded"))){var K=J.closest("table").parent().prev();if(K.length){if(K.is(".hidden")){J.children(".leftEdge").addClass("fa-chevron-left").removeClass("fa-chevron-right")}else{J.children(".leftEdge").addClass("fa-chevron-right").removeClass("fa-chevron-left")}}var N=J.closest("table").parent().next();if(N.length){if(N.is(".hidden")){J.children(".rightEdge").addClass("fa-chevron-right").removeClass("fa-chevron-left")}else{J.children(".rightEdge").addClass("fa-chevron-left").removeClass("fa-chevron-right")}}}else{var L=J.closest("table").parent().siblings();var I=L.length?!L.is(".hidden"):false;J.children(".leftEdge").toggleClass("fa-chevron-right",I).toggleClass("fa-chevron-left",!I);J.children(".rightEdge").toggleClass("fa-chevron-left",I).toggleClass("fa-chevron-right",!I)}}function b(I){if(I){I.style.offsetWidth=I.offsetWidth}}function H(J,O,M){i.each(J.children,function(P,Q){Q.parentId=J.id});var L=i.Deferred();var N=i("<div"+(M.draggable?' draggable="true"':"")+(J[M.nodeId]?' id="'+J[M.nodeId]+'"':"")+(J.parentId?' data-parent="'+J.parentId+'"':"")+">").addClass("node "+(J.className||"")+(O>=M.depth?" slide-up":"")).append('<div class="title">'+J[M.nodeTitle]+"</div>").append(typeof M.nodeContent!=="undefined"?'<div class="content">'+(J[M.nodeContent]||"")+"</div>":"");var I=J.relationship||"";if(M.verticalDepth&&(O+2)>M.verticalDepth){if((O+1)>=M.verticalDepth&&Number(I.substr(2,1))){var K=O+1>=M.depth?"plus":"minus";N.append('<i class="toggleBtn fa fa-'+K+'-square"></i>')}}else{if(Number(I.substr(0,1))){N.append('<i class="edge verticalEdge topEdge fa"></i>')}if(Number(I.substr(1,1))){N.append('<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>')}if(Number(I.substr(2,1))){N.append('<i class="edge verticalEdge bottomEdge fa"></i>').children(".title").prepend('<i class="fa '+M.parentNodeSymbol+' symbol"></i>')}}N.on("mouseenter mouseleave",function(U){var S=i(this),R=false;var Q=S.children(".topEdge");var V=S.children(".rightEdge");var P=S.children(".bottomEdge");var T=S.children(".leftEdge");if(U.type==="mouseenter"){if(Q.length){R=F(S,"parent").visible;Q.toggleClass("fa-chevron-up",!R).toggleClass("fa-chevron-down",R)}if(P.length){R=F(S,"children").visible;P.toggleClass("fa-chevron-down",!R).toggleClass("fa-chevron-up",R)}if(T.length){h(S)}}else{S.children(".edge").removeClass("fa-chevron-up fa-chevron-down fa-chevron-right fa-chevron-left")}});N.on("click",function(P){i(this).closest(".orgchart").find(".focused").removeClass("focused");i(this).addClass("focused")});N.on("click",".topEdge",function(R){R.stopPropagation();var Q=i(this);var P=Q.parent();var S=F(P,"parent");if(S.exist){var T=P.closest("table").closest("tr").siblings(":first").find(".node");if(T.is(".slide")){return}if(S.visible){D(P);T.one("transitionend",function(){if(k(P)){n(Q);h(P)}})}else{g(P)}}else{var U=Q.parent()[0].id;if(e(Q,P,M)){i.ajax({url:i.isFunction(M.ajaxURL.parent)?M.ajaxURL.parent(J):M.ajaxURL.parent+U,dataType:"json"}).done(function(V){if(P.closest(".orgchart").data("inAjax")){if(!i.isEmptyObject(V)){a.call(P.closest(".orgchart").parent(),P,V,M)}}}).fail(function(){console.log("Failed to get parent node data")}).always(function(){r(Q,P,M)})}}});N.on("click",".bottomEdge",function(T){T.stopPropagation();var R=i(this);var Q=R.parent();var S=F(Q,"children");if(S.exist){var P=Q.closest("tr").siblings(":last");if(P.find(".node:visible").is(".slide")){return}if(S.visible){B(Q)}else{v(Q)}}else{var U=R.parent()[0].id;if(e(R,Q,M)){i.ajax({url:i.isFunction(M.ajaxURL.children)?M.ajaxURL.children(J):M.ajaxURL.children+U,dataType:"json"}).done(function(W,X,V){if(Q.closest(".orgchart").data("inAjax")){if(W.children.length){s(Q,W,i.extend({},M,{depth:0}))}}}).fail(function(V,X,W){console.log("Failed to get children nodes data")}).always(function(){r(R,Q,M)})}}});N.on("click",".toggleBtn",function(S){var T=i(this);var Q=T.parent().next();var R=Q.find(".node");var P=Q.children().children(".node");if(P.is(".slide")){return}T.toggleClass("fa-plus-square fa-minus-square");if(R.eq(0).is(".slide-up")){Q.removeClass("hidden");b(P.get(0));P.addClass("slide").removeClass("slide-up").eq(0).one("transitionend",function(){P.removeClass("slide")})}else{R.addClass("slide slide-up").eq(0).one("transitionend",function(){R.removeClass("slide");R.closest("ul").addClass("hidden")});R.find(".toggleBtn").removeClass("fa-minus-square").addClass("fa-plus-square")}});N.on("click",".leftEdge, .rightEdge",function(Q){Q.stopPropagation();var W=i(this);var S=W.parent();var V=F(S,"siblings");if(V.exist){var T=S.closest("table").parent().siblings();if(T.find(".node:visible").is(".slide")){return}if(M.toggleSiblingsResp){var R=S.closest("table").parent().prev();var X=S.closest("table").parent().next();if(W.is(".leftEdge")){if(R.is(".hidden")){j(S,"left")}else{q(S,"left")}}else{if(X.is(".hidden")){j(S,"right")}else{q(S,"right")}}}else{if(V.visible){q(S)}else{j(S)}}}else{var U=W.parent()[0].id;var P=(F(S,"parent").exist)?(i.isFunction(M.ajaxURL.siblings)?M.ajaxURL.siblings(J):M.ajaxURL.siblings+U):(i.isFunction(M.ajaxURL.families)?M.ajaxURL.families(J):M.ajaxURL.families+U);if(e(W,S,M)){i.ajax({url:P,dataType:"json"}).done(function(Z,aa,Y){if(S.closest(".orgchart").data("inAjax")){if(Z.siblings||Z.children){d(S,Z,M)}}}).fail(function(Y,aa,Z){console.log("Failed to get sibling nodes data")}).always(function(){r(W,S,M)})}}});if(M.draggable){N.on("dragstart",function(R){var Z=R.originalEvent;var Q=/firefox/.test(o.navigator.userAgent.toLowerCase());if(Q){Z.dataTransfer.setData("text/html","hack for firefox")}if(N.closest(".orgchart").css("transform")!=="none"){var ab,Y;if(!y.querySelector(".ghost-node")){ab=y.createElementNS("http://www.w3.org/2000/svg","svg");ab.classList.add("ghost-node");Y=y.createElementNS("http://www.w3.org/2000/svg","rect");ab.appendChild(Y);N.closest(".orgchart").append(ab)}else{ab=N.closest(".orgchart").children(".ghost-node").get(0);Y=i(ab).children().get(0)}var P=N.closest(".orgchart").css("transform").split(",");var V=Math.abs(o.parseFloat((M.direction==="t2b"||M.direction==="b2t")?P[0].slice(P[0].indexOf("(")+1):P[1]));ab.setAttribute("width",N.outerWidth(false));ab.setAttribute("height",N.outerHeight(false));Y.setAttribute("x",5*V);Y.setAttribute("y",5*V);Y.setAttribute("width",120*V);Y.setAttribute("height",40*V);Y.setAttribute("rx",4*V);Y.setAttribute("ry",4*V);Y.setAttribute("stroke-width",1*V);var X=Z.offsetX*V;var U=Z.offsetY*V;if(M.direction==="l2r"){X=Z.offsetY*V;U=Z.offsetX*V}else{if(M.direction==="r2l"){X=N.outerWidth(false)-Z.offsetY*V;U=Z.offsetX*V}else{if(M.direction==="b2t"){X=N.outerWidth(false)-Z.offsetX*V;U=N.outerHeight(false)-Z.offsetY*V}}}if(Q){Y.setAttribute("fill","rgb(255, 255, 255)");Y.setAttribute("stroke","rgb(191, 0, 0)");var aa=y.createElement("img");aa.src="data:image/svg+xml;utf8,"+(new XMLSerializer()).serializeToString(ab);Z.dataTransfer.setDragImage(aa,X,U)}else{Z.dataTransfer.setDragImage(ab,X,U)}}var W=i(this);var T=W.closest(".nodes").siblings().eq(0).find(".node:first");var S=W.closest("table").find(".node");W.closest(".orgchart").data("dragged",W).find(".node").each(function(ac,ad){if(S.index(ad)===-1){if(M.dropCriteria){if(M.dropCriteria(W,T,i(ad))){i(ad).addClass("allowedDrop")}}else{i(ad).addClass("allowedDrop")}}})}).on("dragover",function(P){P.preventDefault();if(!i(this).is(".allowedDrop")){P.originalEvent.dataTransfer.dropEffect="none"}}).on("dragend",function(P){i(this).closest(".orgchart").find(".allowedDrop").removeClass("allowedDrop")}).on("drop",function(Q){var V=i(this);var W=V.closest(".orgchart");var U=W.data("dragged");W.find(".allowedDrop").removeClass("allowedDrop");var R=U.closest(".nodes").siblings().eq(0).children();if(!V.closest("tr").siblings().length){V.append('<i class="edge verticalEdge bottomEdge fa"></i>').parent().attr("colspan",2).parent().after('<tr class="lines"><td colspan="2"><div class="downLine"></div></td></tr><tr class="lines"><td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td></tr><tr class="nodes"></tr>').siblings(":last").append(U.find(".horizontalEdge").remove().end().closest("table").parent())}else{var T=parseInt(V.parent().attr("colspan"))+2;var Y='<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>';V.closest("tr").next().addBack().children().attr("colspan",T);if(!U.find(".horizontalEdge").length){U.append(Y)}V.closest("tr").siblings().eq(1).children(":last").before('<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>').end().next().append(U.closest("table").parent());var X=U.closest("table").parent().siblings().find(".node:first");if(X.length===1){X.append(Y)}}var P=parseInt(R.attr("colspan"));if(P>2){R.attr("colspan",P-2).parent().next().children().attr("colspan",P-2).end().next().children().slice(1,3).remove();var S=R.parent().siblings(".nodes").children().find(".node:first");if(S.length===1){S.find(".horizontalEdge").remove()}}else{R.removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove()}W.triggerHandler({type:"nodedropped.orgchart",draggedNode:U,dragZone:R.children(),dropZone:V})})}if(M.createNode){M.createNode(N,J)}L.resolve(N);return L.promise()}function w(R,M,J,I,V){var S;var Q=M.children;var P=Q?Q.length:false;var L=(I.verticalDepth&&(J+1)>=I.verticalDepth)?true:false;if(Object.keys(M).length>1){S=L?R:i("<table>");if(!L){R.append(S)}i.when(H(M,J,I)).done(function(W){if(L){S.append(W)}else{S.append(W.wrap("<tr><td"+(P?' colspan="'+Q.length*2+'"':"")+"></td></tr>").closest("tr"))}if(V){V()}}).fail(function(){console.log("Failed to creat node")})}if(P){if(Object.keys(M).length===1){S=R}var K=(J+1>=I.depth||M.collapsed)?" hidden":"";var O=(I.verticalDepth&&(J+2)>=I.verticalDepth)?true:false;if(!O){S.append('<tr class="lines'+K+'"><td colspan="'+Q.length*2+'"><div class="downLine"></div></td></tr>')}var U='<tr class="lines'+K+'"><td class="rightLine">&nbsp;</td>';for(var N=1;N<Q.length;N++){U+='<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>'}U+='<td class="leftLine">&nbsp;</td></tr>';var T;if(O){T=i("<ul>");if(K){T.addClass(K)}if(J+2===I.verticalDepth){S.append('<tr class="verticalNodes'+K+'"><td></td></tr>').find(".verticalNodes").children().append(T)}else{S.append(T)}}else{T=i('<tr class="nodes'+K+'">');S.append(U).append(T)}i.each(Q,function(){var W=O?i("<li>"):i('<td colspan="2">');T.append(W);w(W,this,J+1,I,V)})}}function m(I,J,K,M){var K=K||I.closest(".orgchart").data("options");var L=J.children||J.siblings;I.find("td:first").attr("colspan",L.length*2);w(I,{children:L},0,K,M)}function s(I,L,K){var K=K||I.closest(".orgchart").data("options");var J=0;m.call(I.closest(".orgchart").parent(),I.closest("table"),L,K,function(){if(++J===L.children.length){if(!I.children(".bottomEdge").length){I.append('<i class="edge verticalEdge bottomEdge fa"></i>')}if(!I.find(".symbol").length){I.children(".title").prepend('<i class="fa '+K.parentNodeSymbol+' symbol"></i>')}v(I)}})}function f(K,J,M,N){var L=this;var I=i("<table>");J.relationship=J.relationship||"001";i.when(H(J,0,M||K.closest(".orgchart").data("options"))).done(function(Q){I.append(Q.removeClass("slide-up").addClass("slide-down").wrap('<tr class="hidden"><td colspan="2"></td></tr>').closest("tr"));I.append('<tr class="lines hidden"><td colspan="2"><div class="downLine"></div></td></tr>');var P='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>';I.append('<tr class="lines hidden">'+P+"</tr>");var O=L.children(".orgchart");O.prepend(I).children("table:first").append('<tr class="nodes"><td colspan="2"></td></tr>').children("tr:last").children().append(O.children("table").last());N()}).fail(function(){console.log("Failed to create parent node")})}function a(I,K,J){f.call(this,I,K,J,function(){if(!I.children(".topEdge").length){I.children(".title").after('<i class="edge verticalEdge topEdge fa"></i>')}g(I)})}function u(L,I,K){var J="";for(var M=0;M<K;M++){J+='<td class="leftLine topLine">&nbsp;</td><td class="rightLine topLine">&nbsp;</td>'}L.parent().prevAll("tr:gt(0)").children().attr("colspan",I*2).end().next().children(":first").after(J)}function A(S,J,I,R){var I=I||S.closest(".orgchart").data("options");var Q=J.siblings?J.siblings.length:J.children.length;var L=S.parent().is("td")?S.closest("tr").children().length:1;var K=L+Q;var N=(K>1)?Math.floor(K/2-1):0;if(S.parent().is("td")){var P=S.closest("tr").prevAll("tr:last");S.closest("tr").prevAll("tr:lt(2)").remove();var O=0;m.call(S.closest(".orgchart").parent(),S.parent().closest("table"),J,I,function(){if(++O===Q){var T=S.parent().closest("table").children("tr:last").children("td");if(L>1){u(T.eq(0).before(S.closest("td").siblings().addBack().unwrap()),K,L);T.addClass("hidden").find(".node").addClass("slide-left")}else{u(T.eq(N).after(S.closest("td").unwrap()),K,1);T.not(":eq("+N+1+")").addClass("hidden").slice(0,N).find(".node").addClass("slide-right").end().end().slice(N).find(".node").addClass("slide-left")}R()}})}else{var M=0;w(S.closest(".orgchart"),J,0,I,function(){if(++M===K){u(S.next().children("tr:last").children().eq(N).after(i('<td colspan="2">').append(S)),K,1);S.closest("tr").siblings().eq(0).addClass("hidden").find(".node").addClass("slide-down");S.parent().siblings().addClass("hidden").slice(0,N).find(".node").addClass("slide-right").end().end().slice(N).find(".node").addClass("slide-left");R()}})}}function d(I,K,J){A.call(I.closest(".orgchart").parent(),I.closest("table"),K,J,function(){I.closest(".nodes").data("siblingsLoaded",true);if(!I.children(".leftEdge").length){I.children(".topEdge").after('<i class="edge horizontalEdge rightEdge fa"></i><i class="edge horizontalEdge leftEdge fa"></i>')}j(I)})}function z(I){var K=I.closest("table").parent();var J=K.parent().siblings();if(K.is("td")){if(F(I,"siblings").exist){J.eq(2).children(".topLine:lt(2)").remove();J.slice(0,2).children().attr("colspan",J.eq(2).children().length);K.remove()}else{J.eq(0).children().removeAttr("colspan").find(".bottomEdge").remove().end().end().siblings().remove()}}else{K.add(K.siblings()).remove()}}}));